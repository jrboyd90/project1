{% extends "base.html" %}

{% block title %} Map {% endblock %}

{% block head %}
<style>
   #map {
    height: 400px;
    width: 100%;
   }
</style>
{% endblock %}

{% block content %}
<div class="row d-flex justify-content-center">
  <div class="col-lg-8 col-md-8 col-sm-8" id="map" style="width: 800px; height: 700px;"></div>
</div>
<script>





  function initMap() {
    var houston = {lat: 29.7604267, lng: -95.3698028};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 9,
      center: houston
    });

    {% for item in mapdata %}

      var markers = {
          coords: {
            lat: {{ item.latitude }},
            lng: {{ item.longitude }} },
          volunteers: {{ item.people_needed }},
          content: '<h6>{{ item.description }}</h6><br><p><b>Name: </b> {{ item.first_name }}<br><b>Adress: </b> {{ item.address1 }}<br><b>Truck Needed: </b>{{ item.truck_needed }}<br><b>Volunteers Needed: </b>{{ item.people_needed }}</p>' +
          '<form class="form" action ="/volunteer_form" method ="post">' +                           
            '<div class="form-group">' +
              '<label for="first_name">Name:</label>' +
              '<input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="last_name">Last Name:</label>' +
              '<input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="phone">Phone:</label>' +
              '<input type="text" class="form-control" id="phone" name="phone" placeholder="###-###-####" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="email">Email Address:</label>' +
              '<input type="email" class="form-control" id="email" name="email" placeholder="yourname@email.com" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="volunteers">Number of Volunteers:</label>' +
              '<select class="form-control" class="volunteers" id="volunteers" name="volunteers">' +
                '<option>1</option>' +
                '<option>2</option>' +
                '<option>3</option>' +
                '<option>4</option>' +
                '<option>5</option>' +
              '</select>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="has_truck">Do you have a large vehicle?:</label>' +
              '<select class="form-control" class="has_truck" id="has_truck" name="has_truck">' +
                '<option></option>' +
                '<option>Yes</option>' +
                '<option>No</option>' +
              '</select>' +
            '</div>' +
          '<input type="hidden" name="id" value="{{ item.id }}"/>' +
          '<button type="submit" class="btn btn-primary btn-lg btn-block">I want to volunteer</button>' +
          '</form>'
      };


      // Loop through markers
      addMarker(markers);

      //Set marker color
      function iconImage() {
        if (markers.volunteers == 0){
          return 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
        }
        else {
          return 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
        }
      };

      // Add Marker Function
      function addMarker(props){



        var marker = new google.maps.Marker({
          position:props.coords,
          map:map,
          icon: iconImage(),
          animation: google.maps.Animation.DROP
        });

        // Check content
        if(props.content){
          var infoWindow = new google.maps.InfoWindow({
            content:props.content
          });


          google.maps.event.addListener(marker, 'dblclick', function(){
            infoWindow.open(map, marker);
          });

          google.maps.event.addListener(marker, 'click', function(){
            infoWindow.close(map, marker);
          });

          google.maps.event.addListener(map, 'click', function(){
            infoWindow.close(map, marker);
          });


        }
      }
    {% endfor %}
  }


</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2iL6ewJ-ZbMXwS2nTEsGXHZbzOOCkFWo&callback=initMap">
</script>
{% endblock %}
